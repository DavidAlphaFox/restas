<html> <head> <meta http-equiv="Content-Type" content="text/html; charset='utf-8'" /> <meta name="keywords" content="restas,web,framework,web framework,REST,Common Lisp,lisp" /> <title>API Reference</title> <link rel="stylesheet" type="text/css" href="../_static/style.css" /> </head> <body> <a href="http://github.com/archimag/restas/"> <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"> </a> <div id="frame"> <div id="page-title"> <h1>RESTAS</h1> <b>Framework for web application development in Common Lisp</b> </div> <div id="menu"> <ul> <li> <a href="../index.html">Home</a>  </li><li> <a href="../overview.html">Overview</a>  </li><li> <a href="../installation.html">Installation</a>  </li><li> <a href="../tutorial/contents.html">Tutorials</a> <ul> <li> <a href="../tutorial/hello-world.html">Hello World</a> </li><li> <a href="../tutorial/pastebin.html">Pastebin</a> </li> </ul> </li><li> <a href="../manual/contents.html">Manual</a> <ul> <li> <a href="../manual/routes.html">Routes</a> </li><li> <a href="../manual/modules.html">Modules</a> </li><li> <a href="../manual/view.html">View</a> </li><li> <a href="../manual/special-pages.html">Special pages</a> </li><li> <a href="../manual/decorators.html">Decorators</a> </li><li> <a href="../manual/daemon.html">Daemonization</a> </li><li> <a href="../manual/slime.html">SLIME</a> </li> </ul> </li><li> <strong>API Reference</strong>  </li> </ul> </div> <div id="content"> <div id="api-reference" class="document"><h1>API Reference<a href="#api-reference" class="headerlink" title="Permalink to this headline">¶</a></h1><!-- -*- RST -*- -->
<a id="api-reference" class="target" name="api-reference"></a><p><dl class="entity-description"><dl id="restas-start"><dt><span class="common-lisp-entity">Function restas:start</span> (module &key hostname (port 80) (context (make-context)) acceptor-class ssl-certificate-file ssl-privatekey-file ssl-privatekey-password)<a href="#restas-start" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd><p>Launches a module for processing HTTP requests. <a class="reference" href="http://restas.lisper.ru/"><span>RESTAS</span></a> supports the concept of <a class="reference" href="http://httpd.apache.org/docs/current/vhosts/"><span>virtual hosts </span></a> and permits placing several sites with different domain names in the context of one process. Serving content on several ports is also possible.</p>
<p><strong><span>Parameters</span></strong>:</p>
<ul>
<li><p class="first">module - <a class="reference" href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_p.htm#package_designator"><span>package designator</span></a>, identifying module defined with aid of <a class="common-lisp-entity" href="index.html#restas-define-module">restas:define-module</a></p>
</li>
<li><p class="first">hostname - the host name for request processing</p>
</li>
<li><p class="first">port - port for accepting requests</p>
</li>
<li><p class="first">context - environment analogous to specified with <a class="common-lisp-entity" href="index.html#restas-mount-submodule">restas:mount-submodule</a>, permits customizing module parameters.</p>
</li>
<li><p class="first">acceptor-class - determines which class of acceptor objects is created  and should be (a symbol naming) a class which inherits from <span class="common-lisp-entity">restas:restas-acceptor</span> or <span class="common-lisp-entity">restas:restas-ssl-acceptor</span>.</p>
</li>
<li><p class="first">ssl-certificate-file - path to SSL certificate file. Lispworks supports using one file containing the key and certificate, in which case the ssl-privatekey-file is not need.</p>
</li>
<li><p class="first">ssl-privatekey-file - path to key file in PEM format.</p>
</li>
<li><p class="first">ssl-privatekey-password - password (as string) for using key file (or NIL, the default, for no password).</p>
</li>
</ul>
<p>This function can be called more than once with different parameters. If different modules were launched for one and the same combination of host name and port number then route conflicts are possible, and, when they happen, the way request dispatch happens is undefined.</p>
</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-reconnect-all-routes"><dt><span class="common-lisp-entity">Function restas:reconnect-all-routes</span> ()<a href="#restas-reconnect-all-routes" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Reinitialises request dispatcher. Usually there is no need to call this function directly, because during evaluation of <a class="common-lisp-entity" href="index.html#restas-mount-submodule">restas:mount-submodule</a> and <a class="common-lisp-entity" href="index.html#restas-define-route">restas:define-route</a> it is called automatically.</dd></dl></p>
<div id="special-variables" class="section"><h2>Special variables<a href="#special-variables" class="headerlink" title="Permalink to this headline">¶</a></h2><p><dl class="entity-description"><dl id="restas-default-host-redirect"><dt><span class="common-lisp-entity">Variable restas:*default-host-redirect*</span><a href="#restas-default-host-redirect" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>All requests to unregistered hosts will be redirected to this default host.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-bindings"><dt><span class="common-lisp-entity">Variable restas:*bindings*</span><a href="#restas-bindings" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>The set of parsed variables of the route is stored here.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-submodule"><dt><span class="common-lisp-entity">Variable restas:*submodule*</span><a href="#restas-submodule" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Active submodule the current route being handled belongs to.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-route"><dt><span class="common-lisp-entity">Variable restas:*route*</span><a href="#restas-route" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>The current route being handled.</dd></dl></p>
</div>
<div id="routes" class="section"><h2>Routes<a href="#routes" class="headerlink" title="Permalink to this headline">¶</a></h2><p><dl class="entity-description"><dl id="restas-define-route"><dt><span class="common-lisp-entity">Macro restas:define-route</span> (name (template &key (method :get) content-type render-method requirement parse-vars decorators) &body body)<a href="#restas-define-route" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd><p>Creates new route in the current module</p>
<ul>
<li><p class="first">name - unique <a href="" class="common-lisp-entity">symbol</a>, serving as route identifier. The same <a href="" class="common-lisp-entity">symbol</a> cannot be used for different routes.</p>
</li>
<li><p class="first">template - URL template for matching a route and a request on its basis. It can contain variables which will be directly available in the body of the route.</p>
</li>
<li><p class="first">method - HTTP method to be handled, possible values are :GET :POST, :PUT, :DELETE.</p>
</li>
<li><p class="first">content-type - result <strong><span>Content-Type</span></strong> HTTP header.</p>
</li>
<li><p class="first">headers - <em><span>plist</span></em> with HTTP headers names and values. A union with <span class="common-lisp-entity">*default-headers*</span> is used, with route option taking precedence.</p>
</li>
<li><p class="first">render-method - object, used by call to <a class="common-lisp-entity" href="index.html#restas-render-object">restas:render-object</a> for processing of the result of route handler before serving it to client.</p>
</li>
<li><p class="first">requirement - arbitrary function called for checking whether a route and a request match each other. If result is <a href="" class="common-lisp-entity">NIL</a> then route is regarded as not satisfying the request.</p>
</li>
<li><p class="first">parse-vars - <em><span>plist</span></em> with variables names (as :hs:`keyword`s) and functions for parsing them.</p>
</li>
<li><p class="first">decorators - list of decorators. See <a href="../manual/decorators.html#decorators">Decorators</a>.</p>
</li>
<li><p class="first">body - handler body can contain arbitrary code; its result is returned to the client (after processing it with <a class="common-lisp-entity" href="index.html#restas-render-object">restas:render-object</a>).</p>
</li>
</ul>
<p>Example of definition of a trivial route:</p>
<p><div class="code"><span class="paren1">(<span class=""><i><span class="symbol">restas:define-route</span></i> main <span class="paren2">(<span class=""><span class="string">""</span></span>)</span><br>&nbsp;&nbsp;<span class="string">"&lt;h1&gt;Hello world!&lt;/h1&gt;"</span></span>)</span></div></p>
<p>For more details about route definition, see <a href="../manual/routes.html#routes">Routes</a></p>
</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-route-symbol"><dt><span class="common-lisp-entity">Function restas:route-symbol</span> (route)<a href="#restas-route-symbol" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Returns <a href="" class="common-lisp-entity">symbol</a>, bound to route object (for example, during request processing such object is bound to <a class="common-lisp-entity" href="index.html#restas-route">restas:*route*</a>).</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-genurl"><dt><span class="common-lisp-entity">Function restas:genurl</span> (route-symbol &rest args)<a href="#restas-genurl" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd><p>Computes URL of the route on the basis of identifying <a href="" class="common-lisp-entity">symbol</a> and the set of values of variables of its URL template (see <a class="common-lisp-entity" href="index.html#restas-define-route">restas:define-route</a>)</p>
<ul>
<li><p class="first">route-symbol - route identifier</p>
</li>
<li><p class="first">args - sequence (in the <em><span>plist</span></em> format) of route variable names and their values.</p>
</li>
</ul>
<p>Example:</p>
<p><div class="code"><span class="paren1">(<span class="">restas:genurl 'my-route<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:arg1</span> <span class="string">"foo"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:arg2</span> <span class="string">"bar"</span></span>)</span></div></p>
<p><strong><span>Important</span></strong>: this functions works right only for routes being in the same module with processed at the call time route.</p>
</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-genurl-submodule"><dt><span class="common-lisp-entity">Function restas:genurl-submodule</span> (submodule-symbol route-symbol &rest args)<a href="#restas-genurl-submodule" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd><p>Analogous to <a class="common-lisp-entity" href="index.html#restas-genurl">restas:genurl</a>, but is used for routes from modules mounted with <a class="common-lisp-entity" href="index.html#restas-mount-submodule">restas:mount-submodule</a>.</p>
<ul>
<li><p class="first">submodule-symbol - identifier of submodule, specified at its definition with <a class="common-lisp-entity" href="index.html#restas-mount-submodule">restas:mount-submodule</a>.</p>
</li>
</ul>
</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-gen-full-url"><dt><span class="common-lisp-entity">Function restas:gen-full-url</span> (route &rest args)<a href="#restas-gen-full-url" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>This function is analogous to <a class="common-lisp-entity" href="index.html#restas-genurl">restas:genurl</a> except that the generated URL also includes the host name.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-redirect"><dt><span class="common-lisp-entity">Function restas:redirect</span> (route-symbol &rest args)<a href="#restas-redirect" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Redirects the request with <span class="common-lisp-entity">hunchentoot:redirect</span> for URL computed with <a class="common-lisp-entity" href="index.html#restas-genurl">restas:genurl</a>. The parameters are analogous to those of function <a class="common-lisp-entity" href="index.html#restas-genurl">restas:genurl</a>.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-abort-route-handler"><dt><span class="common-lisp-entity">Function restas:abort-route-handler</span> (obj &key return-code content-typе)<a href="#restas-abort-route-handler" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Immediately abort handling the route and pass <em><span>OBJ</span></em> to <a class="common-lisp-entity" href="index.html#restas-render-object">restas:render-object</a> to render a response. If the keyword argument <em><span>RETURN-CODE</span></em> is specified then it used to set the HTTP response status to allow you to return a special page (500, 404, etc.) with arbitrary content (by default these pages are formed in a uniform way, regardless of the result returned by the handler).</dd></dl></p>
</div>
<div id="modules" class="section"><h2>Modules<a href="#modules" class="headerlink" title="Permalink to this headline">¶</a></h2><p><dl class="entity-description"><dl id="restas-define-module"><dt><span class="common-lisp-entity">Macro restas:define-module</span> (name &rest options)<a href="#restas-define-module" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Initializes a new module, creates new <a href="" class="common-lisp-entity">package</a>, adds certain service variables to it, and conducts its initialization.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-initialize-module-instance"><dt><span class="common-lisp-entity">Function restas:initialize-module-instance</span> ((module context))<a href="#restas-initialize-module-instance" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>It is a generic function that calling  when the module is mounted with <a class="common-lisp-entity" href="index.html#restas-mount-submodule">restas:mount-submodule</a> and can be used, for example, for additional adjustment of submodule context. It should be placed in the package, defined with aid of <a class="common-lisp-entity" href="index.html#restas-define-module">restas:define-module</a>.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-finalize-module-instance"><dt><span class="common-lisp-entity">Function restas:finalize-module-instance</span> ((module context))<a href="#restas-finalize-module-instance" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Is is a generic function that called at the repeated evaluation of <a class="common-lisp-entity" href="index.html#restas-mount-submodule">restas:mount-submodule</a> and can be used e.g. for freeing resources allocated at submodule initialization.</dd></dl></p>
</div>
<div id="submodules" class="section"><h2>Submodules<a href="#submodules" class="headerlink" title="Permalink to this headline">¶</a></h2><p><dl class="entity-description"><dl id="restas-mount-submodule"><dt><span class="common-lisp-entity">Macro restas:mount-submodule</span> (name (module &rest decorators) &rest bindings)<a href="#restas-mount-submodule" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd><p>Defines a submodule.</p>
<ul>
<li><p class="first">name - identifyer (<a href="" class="common-lisp-entity">symbol</a>) of a submodule.</p>
</li>
<li><p class="first">module - <a class="reference" href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_p.htm#package_designator"><span>package designator</span></a>  of the mounted module.</p>
</li>
<li><p class="first">decorators - list of decorators. See <a href="../manual/decorators.html#decorators">Decorators</a>.</p>
</li>
<li><p class="first">bindings - the set of variables and their values defining the context of submodule. The processing of routes from this submodule will be conducted in this context by using <a href="" class="common-lisp-entity">progv</a>.</p>
</li>
</ul>
<p>Example:</p>
<p><div class="code"><span class="paren1">(<span class="">restas:mount-submodule tmp <span class="paren2">(<span class=""><span class="keyword">#:restas.directory-publisher</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><span class="special">restas.directory-publisher:*baseurl*</span> '<span class="paren3">(<span class=""><span class="string">"tmp"</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><span class="special">restas.directory-publisher:*directory*</span> #P<span class="string">"/tmp/"</span></span>)</span></span>)</span></div></p>
</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-submodule-symbol"><dt><span class="common-lisp-entity">Function restas:submodule-symbol</span> (submodule)<a href="#restas-submodule-symbol" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Returns the <a href="" class="common-lisp-entity">symbol</a> bound to the submodule object (e.g., at request processing time such object is bound to <a class="common-lisp-entity" href="index.html#restas-submodule">restas:*submodule*</a>).</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-submodule-module"><dt><span class="common-lisp-entity">Function restas:submodule-module</span> (submodule)<a href="#restas-submodule-module" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Returns the <a class="reference" href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_p.htm#package_designator"><span>package designator</span></a> associated with submodule object.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-submodule-parent"><dt><span class="common-lisp-entity">Function restas:submodule-parent</span> (submodule)<a href="#restas-submodule-parent" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Returns a submoudle to which the passed submodule is mounted. With aid of macro <a class="common-lisp-entity" href="index.html#restas-mount-submodule">restas:mount-submodule</a> you can create entire hierarchies of submodules.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-with-submodule-context"><dt><span class="common-lisp-entity">Macro restas:with-submodule-context</span> (submodule &body body)<a href="#restas-with-submodule-context" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Lets you execute an arbitrary code at the context of the specified submodule.</dd></dl></p>
</div>
<div id="view" class="section"><h2>View<a href="#view" class="headerlink" title="Permalink to this headline">¶</a></h2><p><dl class="entity-description"><dl id="restas-render-object"><dt><span class="common-lisp-entity">Function restas:render-object</span> (drawer object)<a href="#restas-render-object" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd><p>Generic method used for processing the data returned by the route handler (specified in the body of <a class="common-lisp-entity" href="index.html#restas-define-route">restas:define-route</a>). If you didn't specify :render-method parameter for <a class="common-lisp-entity" href="index.html#restas-define-route">restas:define-route</a> macro then the value of <span class="common-lisp-entity">*default-render-method*</span> from the module where the current route being handled was defined (It is automatically created at module definition time by macro <a class="common-lisp-entity" href="index.html#restas-define-module">restas:define-module</a> and its value is <a href="" class="common-lisp-entity">NIL</a>) is used.</p>
<p>For more detailed description see the section <a href="../manual/view.html#view">View</a>.</p>
</dd></dl></p>
</div>
<div id="context" class="section"><h2>Context<a href="#context" class="headerlink" title="Permalink to this headline">¶</a></h2><p>To provide modularity RESTAS uses a mechanism similar to Buffer-Local Variables`_ in <a class="reference" href="http://www.gnu.org/software/emacs/"><span>GNU Emacs</span></a>.</p>
<p><dl class="entity-description"><dl id="restas-make-context"><dt><span class="common-lisp-entity">Macro restas:make-context</span> (&body bindings)<a href="#restas-make-context" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd><p>Creates dynamic context bindings of dynamic variables to their values. Example:</p>
<p><div class="code"><span class="paren1">(<span class="">restas:make-context <span class="paren2">(<span class=""><span class="special">restas.directory-publisher:*baseurl*</span> '<span class="paren3">(<span class=""><span class="string">"tmp"</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class=""><span class="special">restas.directory-publisher:*directory*</span> #P<span class="string">"/tmp/"</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class=""><span class="special">restas.directory-publisher:*autoindex*</span> t</span>)</span></span>)</span></div></p>
</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-context-add-variable"><dt><span class="common-lisp-entity">Function restas:context-add-variable</span> (context symbol &optional value)<a href="#restas-context-add-variable" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd><p>Adds a new variable to the context.</p>
<ul>
<li><p class="first">context - contex</p>
</li>
<li><p class="first">symbol - <a href="" class="common-lisp-entity">symbol</a>, associated to dynamic variable.</p>
</li>
<li><p class="first">value - value of the variable. If unspecified, then the result of a call to <a href="" class="common-lisp-entity">symbol-value</a> is used.</p>
</li>
</ul>
</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-context-remove-variable"><dt><span class="common-lisp-entity">Function restas:context-remove-variable</span> (context symbol)<a href="#restas-context-remove-variable" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Removes the variable from the context.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-context-symbol-value"><dt><span class="common-lisp-entity">Function restas:context-symbol-value</span> (context symbol => value, present-p)<a href="#restas-context-symbol-value" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Return the <em><span>value</span></em> of a dynamic variable. If the variable is undefined in the context, then for evaluating its value <a href="" class="common-lisp-entity">symbol-value</a> is used and present-p is equal to <a href="" class="common-lisp-entity">NIL</a>.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-with-context"><dt><span class="common-lisp-entity">Macro restas:with-context</span> (context &body body)<a href="#restas-with-context" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Executes the code in the given context with <a href="" class="common-lisp-entity">progv</a>.</dd></dl></p>
</div>
<div id="debugging" class="section"><h2>Debugging<a href="#debugging" class="headerlink" title="Permalink to this headline">¶</a></h2><p><dl class="entity-description"><dl id="restas-debug-mode-on"><dt><span class="common-lisp-entity">Function restas:debug-mode-on</span> ()<a href="#restas-debug-mode-on" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Sets up the debug mode.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-debug-mode-off"><dt><span class="common-lisp-entity">Function restas:debug-mode-off</span> ()<a href="#restas-debug-mode-off" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Cancels debug mode.</dd></dl></p>
<p><dl class="entity-description"><dl id="restas-max-debugging-threads"><dt><span class="common-lisp-entity">Variable restas:*max-debugging-threads*</span><a href="#restas-max-debugging-threads" class="headerlink" title="Permalink to this definition">¶</a></dt></dl><dd>Maximal number of simultaneously debugged threads.</dd></dl></p>
</div>
</div> </div> </div> <div class="bottom">@2009-2011 <a href="mailto:archimag@gmail.com">Moskvitin Andrey</a></div> </body> </html>