<html> <head> <meta http-equiv="Content-Type" content="text/html; charset='utf-8'" /> <meta name="keywords" content="restas,web,framework,web framework,REST,Common Lisp,lisp" /> <title>View</title> <link rel="stylesheet" type="text/css" href="../_static/style.css" /> </head> <body> <a href="http://github.com/archimag/restas/"> <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"> </a> <div id="frame"> <div id="page-title"> <h1>RESTAS</h1> <b>Framework for web application development in Common Lisp</b> </div> <div id="menu"> <ul> <li> <a href="../index.html">Home</a>  </li><li> <a href="../overview.html">Overview</a>  </li><li> <a href="../installation.html">Installation</a>  </li><li> <a href="../tutorial/contents.html">Tutorials</a> <ul> <li> <a href="../tutorial/hello-world.html">Hello World</a> </li><li> <a href="../tutorial/pastebin.html">Pastebin</a> </li> </ul> </li><li> <a href="contents.html">Manual</a> <ul> <li> <a href="routes.html">Routes</a> </li><li> <a href="modules.html">Modules</a> </li><li> <strong>View</strong> </li><li> <a href="special-pages.html">Special pages</a> </li><li> <a href="decorators.html">Decorators</a> </li><li> <a href="daemon.html">Daemonization</a> </li><li> <a href="slime.html">SLIME</a> </li> </ul> </li><li> <a href="../ref/index.html">API Reference</a>  </li> </ul> </div> <div id="content"> <div id="view" class="document"><h1>View<a href="#view" class="headerlink" title="Permalink to this headline">Â¶</a></h1><a id="manual-view" class="target" name="manual-view"></a><p>Separation of application logic from view logic is a powerful and useful technique, frequently used in web application development. <a class="reference" href="http://restas.lisper.ru/"><span>RESTAS</span></a> doesn't force you to use such separation, but, if desired, it is provided by the generic function</p>
<p><div class="code"><span class="paren1">(<span class=""><i><span class="symbol">defgeneric</span></i> restas:render-object <span class="paren2">(<span class="">drawer object</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><span class="keyword">:documentation</span> <span class="string">"Render object via drawer"</span></span>)</span></span>)</span></div></p>
<p>It is always called for processing the data returned by route handlers (defined with <a class="common-lisp-entity" href="../ref/index.html#restas-define-route">restas:define-route</a>). As you see here, two objects are used for content generation: a drawer and a data object, so one can speak about full-fledged logic and view separation, and CL <a class="reference" href="http://lisper.ru/pcl/object-reorientation-generic-functions"><span>multimethods </span></a> make this approach quite powerful. The drawer to use is specified in module variable <span class="common-lisp-entity">*default-render-method*</span> and is set to nil by default. <a class="reference" href="http://restas.lisper.ru/"><span>RESTAS</span></a> defines specialized <cite><span>restas:render-object</span></cite> methods, which can accept the following types:</p>
<ul>
<li><p class="first"><a href="" class="common-lisp-entity">string</a> or <a href="" class="common-lisp-entity">array</a> octets - data is sent to client without any additional processing.</p>
</li>
<li><p class="first"><a href="" class="common-lisp-entity">pathname</a> - file is sent to client by <span class="common-lisp-entity">hunchentoot:handle-static-file</span></p>
</li>
<li><p class="first">integer - result is treated as HTTP status and client receives corresponding special page.</p>
</li>
<li><p class="first">Report error in other cases.</p>
</li>
</ul>
<p>Also there are methods for functions passed as drawer:</p>
<ul>
<li><p class="first"><a href="" class="common-lisp-entity">pathname</a> or integer - default handler is called (data is just sent to client without any processing)</p>
</li>
<li><p class="first">In other cases supplied function is called with funcall for data processing and the result is sent to client.</p>
</li>
</ul>
<p>Apart from this, there is a specialized method for accepting arbitrary <a href="" class="common-lisp-entity">package</a> as drawer. This possibility has following basis:</p>
<ul>
<li><p class="first">Each route has its own name and is bound by <a href="" class="common-lisp-entity">symbol</a>.</p>
</li>
<li><p class="first">The author uses <a class="reference" href="http://code.google.com/p/cl-closure-template/"><span>cl-closure-template</span></a> for view logic almost always, and it compiles templates to functions and creates separate <a href="" class="common-lisp-entity">package</a> for them.</p>
</li>
</ul>
<p>If you follow a small agreement and give templates the same names as routes have, then you can specify as <span class="common-lisp-entity">*default-render-method*</span> the package containing template functions, and <a class="reference" href="http://restas.lisper.ru/"><span>RESTAS</span></a> for processing a data generated by a route handler will automatically call a template function with the same name as the route, but from package with templates. Behold such a little magic implemented in quite simple and understandable way. As far as technically this is just a specializer for <a class="common-lisp-entity" href="../ref/index.html#restas-render-object">restas:render-object</a>, you can use it in other ways, for example, <a class="reference" href="http://github.com/archimag/restas-colorize"><span>restas-colorize</span></a> (pastebin analogue, you can see it in work at <a class="reference" href="http://lisper.ru/apps/format/"><span>http://lisper.ru/apps/format/</span></a>) currently uses the following code for generating its layout:</p>
<p><div class="code"><span class="paren1">(<span class=""><i><span class="symbol">restas:define-default-render-method</span></i> <span class="paren2">(<span class="">obj</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="">closure-template.standard:xhtml-strict-frame<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="">list <span class="keyword">:title</span> <span class="paren4">(<span class="">getf obj <span class="keyword">:title</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:body</span> <span class="paren4">(<span class=""><i><span class="symbol">restas.colorize.view:with-main-menu</span></i><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="">list <span class="keyword">:href-all</span> <span class="paren6">(<span class="">restas:genurl 'list-pastes</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:href-create</span> <span class="paren6">(<span class="">restas:genurl 'create-paste</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:body</span> <span class="paren6">(<span class="">restas:render-object <span class="paren1">(<span class="">find-package '<span class="keyword">#:restas.colorize.view</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:css</span> <span class="paren4">(<span class="">iter <span class="paren5">(<span class="">for item in '<span class="paren6">(<span class=""><span class="string">"style.css"</span> <span class="string">"colorize.css"</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="">collect <span class="paren6">(<span class="">restas:genurl 'css <span class="keyword">:file</span> item</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></div></p>
<p>Here we defined <span class="common-lisp-entity">*default-render-method*</span> as function (for simplicity, macro <span class="common-lisp-entity">restas:define-default-render-method</span> was used) which with aid of "package with templates" generates substantial part of page:</p>
<p><div class="code"><span class="paren1">(<span class="">restas:render-object <span class="paren2">(<span class="">find-package '<span class="keyword">#:restas.colorize.view</span></span>)</span> obj</span>)</span></div></p>
<p>and this part later is used for the generation of complete html code.</p>
<p>And, of course, a developer can define his own specializers of <a class="common-lisp-entity" href="../ref/index.html#restas-render-object">restas:render-object</a> for his own drawer type.</p>
<p>The other way for separation of logic and view can be used, for example, when using <span class="common-lisp-entity">*default-render-method*</span> doesn't fits for a particular route, and it is :render-method parameter of <a class="common-lisp-entity" href="../ref/index.html#restas-define-route">restas:define-route</a>. Example:</p>
<p><div class="code"><span class="paren1">(<span class=""><i><span class="symbol">restas:define-route</span></i> api-method <span class="paren2">(<span class=""><span class="string">"/path/to/method/:(param1)/:(param2)"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:content-type</span> <span class="string">"application/json"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:render-method</span> #'json:encode-json</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="">list <span class="keyword">:field1</span> <span class="paren3">(<span class="">sql-query <span class="string">"select ..."</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:field2</span> <span class="paren3">(<span class="">sql-query <span class="string">"select ..."</span></span>)</span></span>)</span></span>)</span>)<br>
</div></p>
</div> </div> </div> <div class="bottom">@2009-2011 <a href="mailto:archimag@gmail.com">Moskvitin Andrey</a></div> </body> </html>