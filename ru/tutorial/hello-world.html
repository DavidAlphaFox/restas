<html> <head> <meta http-equiv="Content-Type" content="text/html; charset='utf-8'" /> <meta name="keywords" content="restas,web,framework,web framework,REST,Common Lisp,lisp" /> <title>Hello World</title> <link rel="stylesheet" type="text/css" href="../_static/style.css" /> </head> <body> <a href="http://github.com/archimag/restas/"> <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"> </a> <div id="frame"> <div id="page-title"> <h1>RESTAS</h1> <b>Фрэймворк для разработки web-приложений на Common Lisp</b> </div> <div id="menu"> <ul> <li> <a href="../index.html">Начало</a>  </li><li> <a href="../overview.html">Обзор</a>  </li><li> <a href="../installation.html">Установка</a>  </li><li> <a href="contents.html">Введение</a> <ul> <li> <strong>Hello World</strong> </li><li> <a href="pastebin.html">Pastebin</a> </li> </ul> </li><li> <a href="../manual/contents.html">Руководство</a> <ul> <li> <a href="../manual/routes.html">Маршруты</a> </li><li> <a href="../manual/modules.html">Модули</a> </li><li> <a href="../manual/view.html">Представление</a> </li><li> <a href="../manual/special-pages.html">Специальные страницы</a> </li><li> <a href="../manual/decorators.html">Декораторы</a> </li><li> <a href="../manual/daemon.html">Демонизация</a> </li><li> <a href="../manual/slime.html">SLIME</a> </li> </ul> </li><li> <a href="../ref/index.html">API Reference</a>  </li> </ul> </div> <div id="content"> <div id="hello-world" class="document"><h1>Hello World<a href="#hello-world" class="headerlink" title="Permalink to this headline">¶</a></h1><h2 id="простейший-пример">Простейший пример<a href="#простейший-пример" class="headerlink" title="Permalink to this headline">¶</a></h2><!-- -*- RST -*- -->
<a id="tutorial-hello-world" class="target" name="tutorial-hello-world"></a><p>Классический "Hello world":</p>
<p><div class="code"><span class="paren1">(<span class="">asdf:operate 'asdf:load-op '<span class="keyword">#:restas</span></span>)</span><br><br>
<span class="paren1">(<span class=""><i><span class="symbol">restas:define-module</span></i> <span class="keyword">#:restas.hello-world</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><span class="keyword">:use</span> <span class="keyword">:cl</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="">in-package <span class="keyword">#:restas.hello-world</span></span>)</span><br><br>
<span class="paren1">(<span class=""><i><span class="symbol">restas:define-route</span></i> main <span class="paren2">(<span class=""><span class="string">""</span></span>)</span><br>&nbsp;&nbsp;<span class="string">"&lt;h1&gt;Hello world!&lt;/h1&gt;"</span></span>)</span><br><br>
<span class="paren1">(<span class="">restas:start '<span class="keyword">#:restas.hello-world</span> <span class="keyword">:port</span> 8080</span>)</span></div></p>
<p>Если выполнить этот код и открыть в браузере ссылку <a class="reference" href="http://localhost:8080/"><span>http://localhost:8080/</span></a>, то можно увидеть заголовок "Hello world", очень мило :)</p>
<p>Теперь по порядку, строчка за строчкой:</p>
<p>Для начала загружает сам <a class="reference" href="http://restas.lisper.ru/"><span>RESTAS</span></a>:</p>
<p><div class="code"><span class="paren1">(<span class="">asdf:operate 'asdf:load-op '<span class="keyword">#:restas</span></span>)</span></div></p>
<p>Объявляем новый модуль:</p>
<p><div class="code"><span class="paren1">(<span class=""><i><span class="symbol">restas:define-module</span></i> <span class="keyword">#:restas.hello-world</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><span class="keyword">:use</span> <span class="keyword">:cl</span></span>)</span></span>)</span></div></p>
<p>Фактически, данный код просто создаёт пакет (<a href="" class="common-lisp-entity">package</a>) и инициализирует его, добавляя в него несколько переменных. Модуль не является объектом либо символом, а связан с пакетом, и это довольно любопытный момент. Почему так сделано? Я хочу, что бы процесс создания веб-приложения был максимально простым и кратким. А использование пакета в качестве модуля позволяет во многих случаях не указывать модуль явно, а просто помещать код, как-то влияющий на модуль, внутрь связанного с ним пакета.</p>
<p>Меняем текущий пакет, как следует из предыдущего пункта, это важно:</p>
<p><div class="code"><span class="paren1">(<span class="">in-package <span class="keyword">#:restas.hello-world</span></span>)</span></div></p>
<p>Создаём маршрут, ответственный за обработку GET-запроса к корню сайта:</p>
<p><div class="code"><span class="paren1">(<span class=""><i><span class="symbol">restas:define-route</span></i> main <span class="paren2">(<span class=""><span class="string">""</span></span>)</span><br>&nbsp;&nbsp;<span class="string">"&lt;h1&gt;Hello world!&lt;/h1&gt;"</span></span>)</span></div></p>
<p>Внутри макроса <a class="common-lisp-entity" href="../ref/index.html#restas-define-route">restas:define-route</a> может быть произвольный код, который должен вернуть либо строку, либо octets <a href="" class="common-lisp-entity">array</a>, либо <a href="" class="common-lisp-entity">pathname</a> (в этом случае клиент получит соответствующий файл), либо целое число (которое будет интерпретироваться как статус ответа, например <span class="common-lisp-entity">hunchentoot:+http-not-found++</span>). Также, это код может свободно использовать все переменные, указанные в документации на веб-сервер <a class="reference" href="http://www.weitz.de/hunchentoot/"><span>Hunchentoot</span></a> (например, <span class="common-lisp-entity">hunchentoot:*request*</span> или <span class="common-lisp-entity">hunchentoot:*reply*</span>).</p>
<p>Запускаем веб-сервер и активизируем сайт:</p>
<p><div class="code"><span class="paren1">(<span class="">restas:start '<span class="keyword">#:restas.hello-world</span> <span class="keyword">:port</span> 8080</span>)</span></div></p>
<div id="обработка-post-запросов" class="section"><h2>Обработка POST-запросов<a href="#обработка-post-запросов" class="headerlink" title="Permalink to this headline">¶</a></h2><p>А этот пример демонстрирует различную обработку GET и POST-запросов:</p>
<p><div class="code"><span class="paren1">(<span class="">asdf:operate 'asdf:load-op <span class="keyword">:cl-who</span></span>)</span><br>
<span class="paren1">(<span class="">asdf:operate 'asdf:load-op <span class="keyword">:restas</span></span>)</span><br>
<br>
<span class="paren1">(<span class=""><i><span class="symbol">restas:define-module</span></i> <span class="keyword">:restas.example-1</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><span class="keyword">:use</span> <span class="keyword">:cl</span></span>)</span></span>)</span><br>
<br>
<span class="paren1">(<span class="">in-package <span class="keyword">:restas.example-1</span></span>)</span><br>
<br>
<span class="paren1">(<span class=""><i><span class="symbol">restas:define-route</span></i> main <span class="paren2">(<span class=""><span class="string">""</span> <span class="keyword">:method</span> <span class="keyword">:get</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><i><span class="symbol">who:with-html-output-to-string</span></i> <span class="paren3">(<span class="">out</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class=""><span class="keyword">:html</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class=""><span class="keyword">:body</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="paren6">(<span class=""><span class="keyword">:form</span> <span class="keyword">:method</span> <span class="keyword">:post</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class=""><span class="paren1">(<span class=""><span class="keyword">:input</span> <span class="keyword">:name</span> <span class="string">"message"</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class=""><span class="paren1">(<span class=""><span class="keyword">:input</span> <span class="keyword">:type</span> <span class="string">"submit"</span> <span class="keyword">:value</span> <span class="string">"Send"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>
<br>
<span class="paren1">(<span class=""><i><span class="symbol">restas:define-route</span></i> main/post <span class="paren2">(<span class=""><span class="string">""</span> <span class="keyword">:method</span> <span class="keyword">:post</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><i><span class="symbol">who:with-html-output-to-string</span></i> <span class="paren3">(<span class="">out</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class=""><span class="keyword">:html</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class=""><span class="keyword">:body</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="keyword">:div</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class=""><span class="keyword">:b</span> <span class="paren1">(<span class="">who:fmt <span class="string">"test message: ~A"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="">hunchentoot:post-parameter <span class="string">"message"</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="paren6">(<span class=""><span class="keyword">:a</span> <span class="keyword">:href</span> <span class="paren1">(<span class="">restas:genurl 'main</span>)</span></span>)</span> <span class="string">"Try again"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>
<br>
<span class="paren1">(<span class="">restas:start '<span class="keyword">#:restas.example-1</span> <span class="keyword">:port</span> 8080</span>)</span><br>
</div></p>
<p>Выполнив его и открыв страницу <a class="reference" href="http://localhost:8080/"><span>http://localhost:8080/</span></a> , вы увидите элементарную форму, в которую предлагается ввести произвольное сообщение. После чего можно выполнить Send и получить новую страницу, содержащую введённое сообщение и ссылку с предположением повторить ввод. Ещё немного доработать и можно будет продавать :)</p>
<p>Данный пример отличается от предыдущего тем, что содержит уже целых два маршрута, один для обработки GET-запроса, а другой для обработки POST. Как видно, тип запроса, за который отвечает маршрут, можно указать с помощью ключа :method, по-умолчанию это :get. Наличие в имени маршрута 'main/post, отвечающего за обработку POST-запроса, суффикса "post" является чистым совпадением: маршруты могут именоваться произвольным образом, лишь бы каждый маршрут имел уникальное имя. Также, в данном коде для генерации html используется библиотека <a class="reference" href="http://weitz.de/cl-who/"><span>cl-who</span></a>, которую я совершенно не рекомендую использовать для реальных приложений, но для небольших демонстраций это самое то.</p>
</div>
<div id="маршруты-с-параметрами" class="section"><h2>Маршруты с параметрами<a href="#маршруты-с-параметрами" class="headerlink" title="Permalink to this headline">¶</a></h2><p>Шаблон url, указываемый в <a class="common-lisp-entity" href="../ref/index.html#restas-define-route">restas:define-route</a>, не обязан быть столь простым, как в предыдущих примерах, и может содержать несколько параметров, доступных для кода-обработчика, указанного внутри <a class="common-lisp-entity" href="../ref/index.html#restas-define-route">restas:define-route</a>.</p>
<p><div class="code"><span class="paren1">(<span class="">asdf:operate 'asdf:load-op <span class="keyword">:cl-who</span></span>)</span><br>
<span class="paren1">(<span class="">asdf:operate 'asdf:load-op <span class="keyword">:restas</span></span>)</span><br>
<br>
<span class="paren1">(<span class=""><i><span class="symbol">restas:define-module</span></i> <span class="keyword">:restas.example-2</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><span class="keyword">:use</span> <span class="keyword">:cl</span> <span class="keyword">:iter</span></span>)</span></span>)</span><br>
<br>
<span class="paren1">(<span class="">in-package <span class="keyword">:restas.example-2</span></span>)</span><br>
<br>
<span class="paren1">(<span class=""><i><span class="symbol">restas:define-route</span></i> root <span class="paren2">(<span class=""><span class="string">""</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><i><span class="symbol">who:with-html-output-to-string</span></i> <span class="paren3">(<span class="">out</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class=""><span class="keyword">:html</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class=""><span class="keyword">:head</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="keyword">:title</span> <span class="string">"Example 2: Index"</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class=""><span class="keyword">:body</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="keyword">:h1</span> <span class="string">"Index"</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="keyword">:ul</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="">iter <span class="paren1">(<span class="">for x from 1 to 10</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="">who:htm <span class="paren2">(<span class=""><span class="keyword">:li</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class=""><span class="paren4">(<span class=""><span class="keyword">:a</span> <span class="keyword">:href</span> <span class="paren5">(<span class="">restas:genurl 'chapter-?.html <span class="keyword">:id</span> x</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="">who:fmt <span class="string">"Chapter ~A"</span> x</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>
<br>
<span class="paren1">(<span class=""><i><span class="symbol">restas:define-route</span></i> chapter-?.html <span class="paren2">(<span class=""><span class="string">"chapter-:(id).html"</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><i><span class="symbol">who:with-html-output-to-string</span></i> <span class="paren3">(<span class="">out</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class=""><span class="keyword">:html</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class=""><span class="keyword">:head</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="keyword">:title</span> <span class="paren6">(<span class="">who:fmt <span class="string">"Example 2. Chapter ~A"</span> id</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class=""><span class="keyword">:body</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="keyword">:h1</span> <span class="paren6">(<span class="">who:fmt <span class="string">"Chapter ~A"</span> id</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="keyword">:ul</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="">iter <span class="paren1">(<span class="">for x from 1 to 10</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="">who:htm <span class="paren2">(<span class=""><span class="keyword">:li</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class=""><span class="paren4">(<span class=""><span class="keyword">:a</span> <span class="keyword">:href</span> <span class="paren5">(<span class="">restas:genurl 'chapter-?-?.html <span class="keyword">:id1</span> id <span class="keyword">:id2</span> x</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="">who:fmt <span class="string">"Chapter ~A-~A"</span> id x</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="paren6">(<span class=""><span class="keyword">:a</span> <span class="keyword">:href</span> <span class="paren1">(<span class="">restas:genurl 'root</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"Back to Index"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>
<br>
<span class="paren1">(<span class=""><i><span class="symbol">restas:define-route</span></i> chapter-?-?.html <span class="paren2">(<span class=""><span class="string">"chapter-:(id1)-:(id2).html"</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class=""><i><span class="symbol">who:with-html-output-to-string</span></i> <span class="paren3">(<span class="">out</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class=""><span class="keyword">:html</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class=""><span class="keyword">:head</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="keyword">:title</span> <span class="paren6">(<span class="">who:fmt <span class="string">"Example 2. Chapter ~A-~A"</span> id1 id2</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class=""><span class="keyword">:body</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="keyword">:h1</span> <span class="paren6">(<span class="">who:fmt <span class="string">"Chapter ~A-~A"</span> id1 id2</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="keyword">:p</span> <span class="paren6">(<span class="">who:fmt <span class="string">"This is a chapter ~A-~A"</span> id1 id2</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class=""><span class="paren6">(<span class=""><span class="keyword">:a</span> <span class="keyword">:href</span> <span class="paren1">(<span class="">restas:genurl 'chapter-?.html <span class="keyword">:id</span> id1</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="">who:fmt <span class="string">"Back to Chapter ~A"</span> id1</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>
<br>
<span class="paren1">(<span class="">restas:start <span class="keyword">:restas.example-2</span> <span class="keyword">:port</span> 8080</span>)</span></div></p>
<p>Данный пример демонстрирует навигацию по некой "книге с оглавлением" и, кроме параметризованных маршрутов, показывает генерацию ссылок по именам маршрутов.</p>
<p>Код приведённых примеров входит в поставку <a class="reference" href="http://restas.lisper.ru/"><span>RESTAS</span></a> и находиться в директории example.</p>
</div>
</div> </div> </div> <div class="bottom">@2009-2011 <a href="mailto:archimag@gmail.com">Moskvitin Andrey</a></div> </body> </html>