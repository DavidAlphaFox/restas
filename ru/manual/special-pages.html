<html> <head> <meta http-equiv="Content-Type" content="text/html; charset='utf-8'" /> <meta name="keywords" content="restas,web,framework,web framework,REST,Common Lisp,lisp" /> <title>Специальные страницы</title> <link rel="stylesheet" type="text/css" href="../_static/style.css" /> </head> <body> <a href="http://github.com/archimag/restas/"> <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"> </a> <div id="frame"> <div id="page-title"> <h1>RESTAS</h1> <b>Фрэймворк для разработки web-приложений на Common Lisp</b> </div> <div id="menu"> <ul> <li> <a href="../index.html">Начало</a>  </li><li> <a href="../overview.html">Обзор</a>  </li><li> <a href="../installation.html">Установка</a>  </li><li> <a href="../tutorial/contents.html">Введение</a> <ul> <li> <a href="../tutorial/hello-world.html">Hello World</a> </li><li> <a href="../tutorial/pastebin.html">Pastebin</a> </li> </ul> </li><li> <a href="contents.html">Руководство</a> <ul> <li> <a href="routes.html">Маршруты</a> </li><li> <a href="modules.html">Модули</a> </li><li> <a href="view.html">Представление</a> </li><li> <strong>Специальные страницы</strong> </li><li> <a href="decorators.html">Декораторы</a> </li><li> <a href="daemon.html">Демонизация</a> </li><li> <a href="slime.html">SLIME</a> </li> </ul> </li><li> <a href="../ref/index.html">API Reference</a>  </li> </ul> </div> <div id="content"> <div id="специальные-страницы" class="document"><h1>Специальные страницы<a href="#специальные-страницы" class="headerlink" title="Permalink to this headline">¶</a></h1><!-- -*- RST -*- -->
<a id="manual-special-pages" class="target" name="manual-special-pages"></a><p>Если обработчик маршрута возвращает целое число, то оно интерпретируется как код возврата и пользователю отправляется соответствующая специальная старница. Для генерации специальных страниц по-умолчанию используются стандартные средства <a class="reference" href="http://www.weitz.de/hunchentoot/"><span>Hunchentoot</span></a>. Это поведение можно изменить определив специализацию для <a class="common-lisp-entity" href="../ref/index.html#restas-render-object">restas:render-object</a>. Например:</p>
<p><div class="code"><span class="paren1">(<span class=""><i><span class="symbol">defmethod</span></i> restas:render-object <span class="paren2">(<span class=""><span class="paren3">(<span class="">designer mydrawer</span>)</span> <span class="paren3">(<span class="">code <span class="paren4">(<span class="">eql hunchentoot:+http-internal-server-error+</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="">setf <span class="paren3">(<span class="">hunchentoot:content-type*</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"text/plain"</span></span>)</span><br>&nbsp;&nbsp;<span class="string">"Oh, all very bad"</span></span>)</span></div></p>
<p>При этом, может случить так, что если маршрут возвращает hunchentoot:+http-not-found+, то будет формироваться "красивое" сообщение о том, что на данном ресурсе такой страницы нет, но если RESTAS просто не найдёт подходящего маршрута, то будет отдаваться стандартная страница Hunchentoot. Для решение данной проблемы проще всего определить "универсальный" маршрут, который будет проверяться в последнюю очередь:</p>
<p><div class="code"><span class="paren1">(<span class=""><i><span class="symbol">restas:define-route</span></i> not-found <span class="paren2">(<span class=""><span class="string">"*any"</span></span>)</span><br>&nbsp;&nbsp;hunchentoot:+http-not-found+</span>)</span></div></p>
<p>Описанный подход  хорошо подходит для обработки специальных страниц общим для всего модуля образом. Но иногда нужно более частное решение. Например, веб-сервер может взаимодействовать с JavaScript-кодом и в случае ошибки должен возвращать hunchentoot:+http-internal-server-error+, а в теле ответа должно быть сообщение, описывающее тип ошибки. Для реализации подобного функционала можно использовать <a class="common-lisp-entity" href="../ref/index.html#restas-abort-route-handler">restas:abort-route-handler</a>. Например, вызов</p>
<p><div class="code"><span class="paren1">(<span class="">restas:abort-route-handler <span class="string">"data invalid"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:return-code</span> hunchentoot:+http-internal-server-error+<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">:content-type</span> <span class="string">"text/plain"</span></span>)</span></div></p>
<p>отправит клиенту ответ с кодом 500 и сообщение "data invalid".</p>
</div> </div> </div> <div class="bottom">@2009-2011 <a href="mailto:archimag@gmail.com">Moskvitin Andrey</a></div> </body> </html>